[platformio]
default_envs = openlux

; ---------------------------------------------------------------------------
; Base configuration (common to all environments)
; ---------------------------------------------------------------------------
[env]
platform = espressif32 @ 6.12.0
board = esp32dev        ; change to your board if needed
framework = arduino
monitor_speed = 115200
monitor_filters = esp32_exception_decoder
upload_speed = 921600
extra_scripts = scripts/build_info.py
build_flags =
    -DCORE_DEBUG_LEVEL=3        ; 0 none, 1 error, 2 warn, 3 info, 4 debug, 5 verbose
    -DLOG_LOCAL_LEVEL=ESP_LOG_INFO
    -DMQTT_MAX_PACKET_SIZE=1024 ; Increase MQTT buffer for long status messages
    -DOPENLUX_ENABLE_LOGGING=1  ; flip to 0 (or override env) to strip non-error logs
lib_deps =
    esphome/AsyncTCP-esphome @ ^2.1.4
    WiFi
    ArduinoOTA
    ESPmDNS
    tzapu/WiFiManager @ ^2.0.17
    knolleary/PubSubClient @ ^2.8

; ---------------------------------------------------------------------------
; Production (default)
; ---------------------------------------------------------------------------
[env:openlux]
platform = ${env.platform}
board = ${env.board}
framework = ${env.framework}
monitor_speed = ${env.monitor_speed}
monitor_filters = ${env.monitor_filters}
upload_speed = ${env.upload_speed}
build_flags =
    ${env.build_flags}
    -UOPENLUX_ENABLE_LOGGING
    -DOPENLUX_ENABLE_LOGGING=0
lib_deps = ${env.lib_deps}

; ---------------------------------------------------------------------------
; Debug (more verbose logging)
; ---------------------------------------------------------------------------
[env:openlux-debug]
platform = ${env.platform}
board = ${env.board}
framework = ${env.framework}
monitor_speed = ${env.monitor_speed}
monitor_filters = ${env.monitor_filters}
upload_speed = ${env.upload_speed}
build_flags =
    ${env.build_flags}
    -DCORE_DEBUG_LEVEL=4
    -DLOG_LOCAL_LEVEL=ESP_LOG_DEBUG
lib_deps = ${env.lib_deps}
upload_port = openlux.local      ; change to your device IP if needed
upload_flags =
    --auth=openlux123
    --port=3232
    --timeout=120
; ---------------------------------------------------------------------------
; OTA (WiFi upload)
; ---------------------------------------------------------------------------
[env:openlux-ota]
platform = ${env.platform}
board = ${env.board}
framework = ${env.framework}
monitor_speed = ${env.monitor_speed}
monitor_filters = ${env.monitor_filters}
build_flags = ${env.build_flags}
lib_deps = ${env.lib_deps}
upload_protocol = espota
upload_port = openlux.local      ; change to your device IP if needed
upload_flags =
    --auth=openlux123
    --port=3232
    --timeout=120
